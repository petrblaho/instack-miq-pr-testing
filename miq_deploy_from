#!/usr/bin/bash

while [[ $# > 1 ]]
do
key="$1"

case $key in
    -u|--user)
    GITHUB_USER="$2"
    shift
    ;;
    -b|--branch)
    BRANCH="$2"
    shift
    ;;
    -i|--image)
    IMAGE="$2"
    shift
    ;;
    *)
            # unknown option
    ;;
esac
shift
done

source set_variables

./generate_miq_install --user $GITHUB_USER --branch $BRANCH
./miq_build_image --image $IMAGE --password smartvm
./miq_provision --image $IMAGE --miq-vm-name $MIQ_VM_NAME

# to set MIQ_IP
source set_variables

./setup_routing --instack-ip $INSTACK_IP --miq-ip $MIQ_IP --host-ip $HOST_IP
./wait_for_miq --miq-ip $MIQ_IP

source set_variables

# register instack undercloud in miq as OpenstackInfra Provider
./miq_register_instack --miq-ip $MIQ_IP --instack-ip $INSTACK_IP --os-username $OS_USERNAME --os-password $OS_PASSWORD --ssh-username $SSH_USERNAME --ssh-key "$SSH_KEY"

./print_info --instack-ip $INSTACK_IP --miq-ip $MIQ_IP --host-ip $HOST_IP
